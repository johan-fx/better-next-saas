---
description: This rule describes the project folder structure and environment variables
globs: 
alwaysApply: false
---
# Project Structure & Environment Variables

## ğŸ—ï¸ Architecture Overview

This project follows a **hexagonal (modular) architecture** with **Better Auth integration** that promotes separation of concerns, maintainability, and scalability.

### Key Benefits

- ğŸ”’ **Encapsulation** - Each module contains all related functionality
- ğŸ§ª **Testability** - Isolated modules are easier to test independently
- ğŸ“ˆ **Scalability** - Add new modules without affecting existing ones
- ğŸ› ï¸ **Maintainability** - Clear boundaries between different business domains
- ğŸ” **Authentication-First** - Built-in authentication context throughout the application

## ğŸ“ Project Structure

```bash
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                 # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ [locale]/                 # Internationalized routes
â”‚   â”‚   â”‚   â”œâ”€â”€ (private)/            # ğŸ”’ Private/Protected Route Group
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx        # Authentication wrapper + sidebar
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ dashboard/        # Protected dashboard section
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx      # Main dashboard page
â”‚   â”‚   â”‚   â””â”€â”€ auth/                 # ğŸ”“ Public 
â”‚   â”‚   â”œâ”€â”€ api/             # API routes
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/        # Better Auth endpoints
â”‚   â”‚   â”‚   â””â”€â”€ trpc/         # tRPC endpoints
â”‚   â”‚   â””â”€â”€ globals.css      # Global styles
â”‚   â”œâ”€â”€ lib/                 # Core configurations
â”‚   â”‚   â”œâ”€â”€ auth.ts          # Better Auth server configuration
â”‚   â”‚   â”œâ”€â”€ auth-client.ts   # Better Auth client configuration
â”‚   â”‚   â”œâ”€â”€ env.ts           # Environment validation (CENTRALIZED)
â”‚   â”‚   â””â”€â”€ db/              # Database configuration
â”‚   â”œâ”€â”€ trpc/                # tRPC exports and documentation
â”‚   â”œâ”€â”€ components/          # Shared UI components
â”‚   â”œâ”€â”€ hooks/               # Shared React hooks
â”‚   â”œâ”€â”€ messages/            # Translation files
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”œâ”€â”€ {domain}/
â”‚   â”‚   â”‚   â”œâ”€â”€ server/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ params.ts  # NUQS Query params definitions
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ router.ts  # tRPC procedures router
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ components/  # Reusable components
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ views/       # Page-level components
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/             # Business logic, utils
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/           # Custom React hooks
â”‚   â”‚   â”‚   â””â”€â”€ types.ts         # TypeScript type definitions
```

## ğŸ”§ Environment Variables - CRITICAL RULES

### âš ï¸ ALWAYS USE CENTRALIZED VALIDATION

**NEVER** duplicate environment variable validation. **ALWAYS** use [env.ts](mdc:src/lib/env.ts):

```typescript
// âœ… CORRECT - Use centralized validation
import { env } from '@/lib/env'

export function someFunction() {
  console.log(`Database: ${env.DATABASE_URL}`)
  console.log(`MailDev: ${env.MAILDEV_WEB_URL}`)
}

// âŒ WRONG - Don't manually validate env vars
const DATABASE_URL = process.env.DATABASE_URL
if (!DATABASE_URL) throw new Error('Missing DATABASE_URL')
```

### Environment Variable Categories in [env.ts](mdc:src/lib/env.ts)

1. **App Configuration** - APP_NAME, APP_LOGO_URL, etc.
2. **Database** - DATABASE_URL (required)
3. **Better Auth** - BETTER_AUTH_SECRET (required, min 32 chars), BETTER_AUTH_URL
4. **Social Providers** - GITHUB_CLIENT_ID, GOOGLE_CLIENT_ID (optional)
5. **SMTP Email** - SMTP_HOST, SMTP_FROM, etc. (conditional validation)
6. **Testing (MailDev)** - MAILDEV_WEB_URL, MAILDEV_SMTP_HOST, MAILDEV_SMTP_PORT
7. **Email Testing** - MAILSLURP_API_KEY (optional)

### Adding New Environment Variables

1. Add to the Zod schema in [env.ts](mdc:src/lib/env.ts)
2. Add to the env object parsing
3. Use proper validation (URL, email, min length, etc.)
4. Provide sensible defaults where appropriate
5. Update TypeScript type automatically via Zod inference

## ğŸ” Authentication Patterns

### File References

- Server config: [auth.ts](mdc:src/lib/auth.ts)
- Client config: [auth-client.ts](mdc:src/lib/auth-client.ts)
- tRPC router: [router.ts](mdc:src/trpc/routers/_app.ts)
- Database schema: [schema.ts](mdc:src/lib/db/schema.ts)

### Client-Side Authentication Pattern

```typescript
'use client'
import { useSession, signIn, signOut } from '@/lib/auth-client'

export function AuthButton() {
  const { data: session, isPending } = useSession()
  // Handle loading, authenticated, and unauthenticated states
}
```

### Server-Side Authentication Pattern

```typescript
import { auth } from '@/lib/auth'
import { headers } from 'next/headers'

export default async function ProtectedPage() {
  const session = await auth.api.getSession({
    headers: await headers()
  })
  
  if (!session) redirect('/login')
  // Guaranteed authenticated user context
}
```

## ğŸ—„ï¸ Database Patterns

### Always use [schema.ts](mdc:src/lib/db/schema.ts) for

- Better Auth table definitions
- Custom application tables
- Type-safe database operations with Drizzle ORM

### Common Database Scripts

```bash
npm run db:generate  # Generate migrations
npm run db:migrate   # Apply migrations  
npm run db:push      # Push schema (development)
npm run db:studio    # Open Drizzle Studio
```

## ğŸŒ Internationalization

### Key Files

- [middleware.ts](mdc:middleware.ts) - Locale detection and routing
- [i18n/](mdc:src/i18n) - Configuration
- [messages/](mdc:src/messages) - Translation files

### URL Structure

- `/[locale]/` - All routes are internationalized
- Automatic locale detection and routing

## ğŸ¨ UI Components

- Always use shadcn/ui components from [components/ui/](mdc:src/components/ui)
- Shared components go in [components/](mdc:src/components)

## ğŸ“¦ Import Patterns

### Use Path Aliases

```typescript
// âœ… CORRECT
import { env } from '@/lib/env'
import { Button } from '@/components/ui/button'

// âŒ WRONG  
import { env } from '../../../src/lib/env'
```

## ğŸ”„ Code Quality Rules

1. **Keep files small and focused** (<200 lines)
2. **Write clean, simple & readable code**
3. **Test after every meaningful change**
4. **Use clear & consistent naming**
5. **Add explanatory comments**
6. **Think thoroughly before coding**

## ğŸš¨ Critical Reminders

- **NEVER** duplicate environment variable validation
- **ALWAYS** import from `@/lib/env` for environment variables
- **ALWAYS** use Better Auth context in oRPC procedures
- **ALWAYS** follow the hexagonal architecture pattern
- **ALWAYS** use TypeScript for type safety
- **ALWAYS** validate environment variables with Zod in [env.ts](mdc:src/lib/env.ts)
